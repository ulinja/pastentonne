# Pastentonne

A dead simple pastebin.

## Setup

Create a `.env` file in the project root by copying the supplied `.env.example` file:

```bash
cp -i .env.example .env
```

Make sure to cusomize the environment variables to suit your needs:

| Environment Variable               | Description                                  | Example Value                                                                                             |
| ---------------------------------- | -------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| TIMEZONE                           | Name of the host's local timezone            | `Europe/Berlin`                                                                                           |
| UID                                | Unix user ID of the container user           | `1000`                                                                                                    |
| GID                                | Unix group ID of the container user          | `1000`                                                                                                    |
| NUXT_DATA_DIR                      | Pastentonne data folder inside the container | `/data/app`                                                                                               |
| NUXT_SESSION_PASSWORD              | JWT Encryption Secret                        | a very long (> 64 bytes) random string                                                                    |
| NUXT_OAUTH_AUTHENTIK_CLIENT_ID     | Authentik Client ID for pastentonne          | random string generated by Authentik                                                                      |
| NUXT_OAUTH_AUTHENTIK_CLIENT_SECRET | Authentik Client Secret for pastentonne      | random string generated by Authentik                                                                      |
| NUXT_OAUTH_AUTHENTIK_DOMAIN        | Authentik server domain                      | `auth.example.com`                                                                                        |
| NUXT_OAUTH_AUTHENTIK_REDIRECT_URL  | Authentik OAuth Callback URL in pastentonne  | `https://pastentonne.example.com/auth/authentik` in prod or `http://localhost:8000/auth/authentik` in dev |

Make sure that you bind `$NUXT_DATA_DIR` as a volume on your Docker host and that `$UID:$GID`
has read/write access to this directory. Otherwise, paste data will not persist across container restarts.

## Production

Build and run the application for production:

```bash
docker compose -f docker/app.docker-compose.yml --env-file .env up --build --force-recreate --remove-orphans
```

## Development

To start development, make sure to install dependencies locally on your host:

```bash
npm install
```

Start the development docker stack on `http://localhost:8000`:

```bash
docker compose -f docker/app.docker-compose.yml -f docker/app.dev.override.docker-compose.yml --env-file .env up --build --force-recreate --remove-orphans
```

To create the database or apply schema changes, run:

```bash
docker exec -it pastentonne npm run db:push
```

You _can_ run the nuxt dev server locally, i.e. with `npm run dev` outside of Docker, but this is _(not recommended)_.
To do this, make sure you first set `$NUXT_DATA_DIR` in your `.env` file to `./data`, otherwise you will run into
permission errors. Then, start the Nuxt dev server:

```bash
npm run dev
```
